# CLAUDE - Configuration de Comportement HerbisVeritas V2

## üìã Instructions Permanentes

Ce fichier d√©finit les **patterns de comportement obligatoires** que Claude doit suivre syst√©matiquement lors du d√©veloppement de HerbisVeritas V2.

**‚ö†Ô∏è CRITIQUE : Claude DOIT consulter ce fichier avant CHAQUE action significative.**

---

## üéØ Contexte Projet

- **Projet :** inherbisveritas (aka HerbisVeritas V2) - E-commerce cosm√©tique bio
- **Stack :** Next.js 15 + TypeScript + Supabase + next-intl 
- **Architecture :** MVP 13 tables, 12 semaines de d√©veloppement
- **Objectif :** Launch-ready sous ‚Ç¨125k budget

---

## üîß Patterns de D√©veloppement

### 1. **Lecture Syst√©matique Obligatoire**
Avant TOUTE action, Claude DOIT lire dans cet ordre :
- [ ] `CLAUDE.md` (ce fichier)
- [ ] `docs/DEVELOPMENT_PLAN_MVP.md` (roadmap)
- [ ] `docs/DATABASE_SCHEMA_MVP.md` (sch√©ma actuel)
- [ ] `.env.local` (configuration)

### 2. **Architecture MVP Stricte**
- ‚úÖ **UNIQUEMENT** les 13 tables valid√©es
- ‚úÖ **UNIQUEMENT** les 7 labels HerbisVeritas d√©finis
- ‚úÖ **UNIQUEMENT** FR/EN pour MVP (DE/ES ‚Üí V2)
- ‚úÖ **UNIQUEMENT** 3 r√¥les users (user/admin/dev)
- ‚ùå **JAMAIS** ajouter de complexit√© non-MVP

### 3. **Gestion des Fichiers**
```bash
# TOUJOURS lire avant d'√©diter
Read ‚Üí Edit/Write
# JAMAIS √©craser sans lire
# TOUJOURS pr√©server les patterns existants
```

### 3 bis Structure & Placement des Fichiers

- ‚úÖ Respecter la structure de dossiers d√©finie dans `docs/PROJECT_STRUCTURE.md`.
- ‚úÖ V√©rifier avant cr√©ation qu'un fichier **de m√™me nom ou r√¥le n'existe pas d√©j√†** ailleurs.
- ‚úÖ Centraliser les composants g√©n√©riques dans `src/components/`, les pages dans `app/`, et les tests dans `tests/`.
- ‚úÖ Les noms de fichiers doivent suivre la convention d√©finie (`PascalCase` pour composants, `kebab-case` pour fichiers utilitaires).
- ‚ùå Interdiction de cr√©er un **doublon fonctionnel** (ex. `Cart.tsx` et `Cart/index.tsx`).

### 4. **Conventions Nommage Next.js (DEV.TO Best Practices)**

**R√®gles Strictes Bas√©es sur Standards Industrie :**

#### **Fichiers & Dossiers :**
- ‚úÖ **kebab-case** pour TOUS les fichiers et dossiers (`user-profile.tsx`, `data-table.tsx`)
- ‚úÖ **Consistance absolue** ‚Üí JAMAIS m√©langer les conventions
- ‚úÖ **Compatibilit√© cross-platform** ‚Üí Windows/Linux/macOS
- ‚úÖ **URL-friendly** structure pour SEO et navigation

#### **Composants React :**
- ‚úÖ **PascalCase** pour noms composants (`function UserProfile()`, `const DataTable`)
- ‚úÖ **Alignement** nom composant ‚Üî nom fichier (`user-profile.tsx` ‚Üí `UserProfile`)
- ‚úÖ **Descriptif** et business-oriented

#### **Structure Dossiers UI :**
```bash
src/components/
‚îú‚îÄ‚îÄ ui/                    # kebab-case (shadcn/ui standard)
‚îÇ   ‚îú‚îÄ‚îÄ button.tsx         # kebab-case fichiers
‚îÇ   ‚îú‚îÄ‚îÄ input.tsx         # PascalCase composants
‚îÇ   ‚îî‚îÄ‚îÄ data-table.tsx    # align√© avec DataTable component
‚îú‚îÄ‚îÄ features/             # modules m√©tier kebab-case
‚îÇ   ‚îú‚îÄ‚îÄ user-profile.tsx  
‚îÇ   ‚îî‚îÄ‚îÄ product-catalog.tsx
```

#### **Interdictions Absolues :**
- ‚ùå **Doublons casse** : `ui/` ET `UI/` (Git Windows conflict)
- ‚ùå **Mix conventions** : `UserProfile.tsx` + `data-table.tsx` dans m√™me dossier
- ‚ùå **PascalCase dossiers** : `Components/` ‚Üí `components/`
- ‚ùå **Underscores** : `user_profile.tsx` ‚Üí `user-profile.tsx`

#### **Validation Pre-Commit :**
```bash
# V√©rifier absence doublons casse
find src/ -name "*" | sort | uniq -i -c | sort -nr | head -5
# Must return 1 per unique filename (case-insensitive)
```

**Source :** [Next.js Component Naming Best Practices](https://dev.to/vikasparmar/nextjs-component-naming-conventions-best-practices-for-file-and-component-names-39o2)
- ‚ùå Interdiction de placer des fichiers **hors du dossier pr√©vu** (ex. pas de composant dans `app/`).
- ‚ùå Interdiction de cr√©er de nouveaux dossiers sans validation (valider avec plan MVP).

**Pattern obligatoire avant cr√©ation :**
1. üìÇ V√©rifier si le fichier existe d√©j√† (`git grep`, recherche projet).
2. üìñ Lire `docs/PROJECT_STRUCTURE.md` ‚Üí identifier le bon dossier cible.
3. ‚úÖ Cr√©er le fichier uniquement si non existant, au bon emplacement.
---

### 4. **TodoWrite Obligatoire**
- ‚úÖ Cr√©er todo AVANT de commencer une t√¢che multi-√©tapes
- ‚úÖ Marquer in_progress IMM√âDIATEMENT au d√©but
- ‚úÖ Marquer completed D√àS que fini
- ‚úÖ Nettoyer la liste si obsol√®te

### 5. **Documentation Tra√ßable**
Chaque modification DOIT √™tre :
- üìù Document√©e avec raison business
- üè∑Ô∏è Tagu√©e avec version/date
- üîó Li√©e au plan MVP
- ‚úÖ Valid√©e contre l'architecture

### 6. **R√®gles de Commit Strictes**
Format obligatoire : Conventional Commits en fran√ßais
```bash
type(scope): description concise

# Exemples valides :
feat(auth): ajout syst√®me 3 r√¥les utilisateur
fix(cart): correction calcul total panier invit√©  
docs(schema): mise √† jour architecture 13 tables
refactor(products): optimisation requ√™tes Supabase
```

**Interdictions commits :**
- ‚ùå Emojis/√©moticons (üöÄ, ‚úÖ, etc.)
- ‚ùå Signatures Claude automatiques  
- ‚ùå Messages anglais
- ‚ùå Descriptions verbeuses

**Pattern obligatoire avant commit :**
1. üìã Interroger d√©veloppeur sur mise √† jour documentation requise
2. üìã C:\inherbisveritas\doc est le dossier de la documentation d√©finitive
3. üìã C:\inherbisveritas\docs est le dossier de la documentation temporaire
4. ‚úÖ Valider coh√©rence avec plan MVP  
5. üîç Message concis d√©crivant uniquement les changements

### 7. **R√®gles de Documentation**
**Style obligatoire :**
- ‚úÖ Ton neutre, purement descriptif
- ‚úÖ Langage technique pr√©cis
- ‚úÖ Structure logique avec sections claires
- ‚ùå Emphase excessive (gras/italique abusif)  
- ‚ùå Emojis/√©moticons
- ‚ùå Formulation marketing/commerciale

**Validation documentation :**
- Chaque nouveau fichier .md doit √™tre approuv√© explicitement
- Documentation existante : modification seulement si demand√©e
- Interroger sur opportunit√© mise √† jour avant chaque commit

---

## üö´ Interdictions Strictes

### ‚ùå **Ne JAMAIS faire :**
- Cr√©er des tables non-MVP
- Ajouter des langues autres que FR/EN
- Complexifier au-del√† du plan MVP
- Modifier le sch√©ma 13 tables sans validation
- Ignorer les 7 labels HerbisVeritas d√©finis
- Cr√©er des features non-planifi√©es
- Bypasser la documentation

### ‚ùå **Ne JAMAIS oublier :**
- Lire CLAUDE.md avant chaque action
- V√©rifier l'architecture MVP
- Documenter les changements
- Maintenir la tra√ßabilit√©
- Respecter le budget temps/complexit√©

---

## ‚úÖ Validations Requises

Avant CHAQUE modification importante :
1. **Coh√©rence MVP** : Est-ce dans le plan 12 semaines ?
2. **Architecture** : Respecte les 13 tables ?
3. **Business** : Sert les objectifs de lancement ?
4. **Simplicit√©** : Minimal viable ?
5. **Documentation** : Tra√ßable pour nouveaux devs ?

---

## üéØ Objectifs Business √† Garder en T√™te

- üöÄ **Launch ready** en 12 semaines maximum
- üí∞ **Budget** sous ‚Ç¨125k ann√©e 1  
- üë• **Support** 1,000+ utilisateurs simultan√©s
- üõí **E-commerce** complet (panier invit√© + Stripe)
- üìù **CMS** autonome pour contenu
- üè∑Ô∏è **Labels HerbisVeritas** + syst√®me partenaires
- üåê **i18n** FR/EN seulement

---

## 8. **Fronti√®re Client/Serveur Next.js 15**

### R√®gles Obligatoires
√âviter fuites de secrets, erreurs d'hydratation, bloat du bundle et bugs de runtime en respectant strictement la s√©paration Client/Serveur Next.js 15 App Router.

#### **Choix du type de composant**
- ‚úÖ **Par d√©faut Server Components** - Passer en Client uniquement si interactivit√©/hooks/APIs navigateur n√©cessaires
- ‚úÖ **"use client"** entra√Æne tout son graphe d'imports c√¥t√© client ‚Üí attention imports involontaires
- ‚úÖ **Network Boundary** : data + rendu serveur, micro-interactions client

#### **Secrets & code serveur uniquement**
- ‚úÖ Taguer modules sensibles avec `import "server-only"` en t√™te ‚Üí casse build si import c√¥t√© client
- ‚ùå **JAMAIS** exposer variables d'env avec `NEXT_PUBLIC_` si sensibles ‚Üí inlin√©es dans bundle
- ‚úÖ SDK serveur (Stripe Node, ORM, fs) ‚Üí `server-only` obligatoire

#### **S√©rialisation Server ‚Üí Client**
- ‚úÖ **Uniquement objets JSON s√©rialisables** en props vers Client Components
- ‚ùå **JAMAIS** classes, fonctions, Dates non s√©rialis√©es entre Server/Client

#### **Hydratation & logique client-only**
- ‚ùå **Aucun acc√®s** window/localStorage/Date.now() pendant render serveur
- ‚úÖ **D√©placer dans useEffect** ou isoler via client component
- ‚úÖ Contenu volontairement diff√©rent client/serveur ‚Üí d√©f√©rer au montage

#### **Imports et bundle**
- ‚ùå **√âviter** import libs lourdes/serveur depuis modules client ‚Üí grossit bundle
- ‚úÖ **dynamic(() => import(...), { ssr: false })** uniquement pour strict client-only
- ‚úÖ **Runtime Node.js** par d√©faut, Edge r√©serv√© cas adapt√©s

#### **Data fetching & cache**
- ‚úÖ **Server Components** : fetch/ORM c√¥t√© serveur avec `cache: 'no-store'` ou `next: { revalidate: N }`
- ‚ùå **√âviter double fetch** SSR puis refetch client si non n√©cessaire

### Checklist Pr√©-Commit Client/Serveur
- [ ] Composants serveur par d√©faut, chaque "use client" justifi√©
- [ ] Aucun secret/SDK serveur/fs/ORM import√© en client (`server-only` sur helpers sensibles)
- [ ] Props Server‚ÜíClient s√©rialisables (pas classes/fonctions/Date brutes)
- [ ] Pas d'acc√®s window/localStorage au render serveur
- [ ] `NEXT_PUBLIC_*` uniquement variables r√©ellement publiques
- [ ] Pas de double fetch inutile serveur/client

---

## üîÑ Workflow Standard

```mermaid
graph TD
    A[Demande utilisateur] --> B[Lire CLAUDE.md]
    B --> C[Lire docs MVP]
    C --> D[Valider vs architecture]
    D --> E{MVP conforme?}
    E -->|Non| F[Refuser/Simplifier]
    E -->|Oui| G[TodoWrite]
    G --> H[Impl√©menter]
    H --> I[Documenter]
    I --> J[Marquer compl√©t√©]
```

---

## üìû Points d'Escalade

Si **conflit** entre demande utilisateur et architecture MVP :
1. üõë **STOPPER** l'action
2. üìã **EXPLIQUER** le conflit architecture
3. üí° **PROPOSER** alternative MVP-compliant
4. ‚úÖ **ATTENDRE** validation utilisateur
5. üìù **DOCUMENTER** la d√©cision

---

## üîß Configuration Supabase

- **Project ID :** `mntndpelpvcskirnyqvx`
- **URL :** `https://mntndpelpvcskirnyqvx.supabase.co`
- **Migration actuelle :** `001_mvp_schema.sql`
- **√âtat attendu :** 13 tables + 7 enums + RLS

---

## üìö R√©f√©rences Critiques

- `docs/DEVELOPMENT_PLAN_MVP.md` ‚Üí Planning 12 semaines
- `docs/DATABASE_SCHEMA_MVP.md` ‚Üí Architecture technique
- `src/types/database.ts` ‚Üí Types TypeScript MVP
- `supabase/migrations/001_mvp_schema.sql` ‚Üí Sch√©ma SQL
- `package.json` scripts ‚Üí Commandes npm

---

**Version :** 1.0.0  
**Derni√®re MAJ :** 2025-01-28  
**Statut :** ‚úÖ ACTIF

---

## üéØ Prochaines √âtapes Prioritaires

Selon le plan MVP, les prochaines actions sont :
1. ‚úÖ Sch√©ma 13 tables (FAIT)
2. üîÑ Configuration labels HerbisVeritas (EN COURS)
3. üìã Setup shadcn/ui design system
4. üåê Configuration next-intl FR/EN
5. üë§ Syst√®me auth 3 r√¥les

**Claude : Consulte TOUJOURS cette liste avant de sugg√©rer des actions !**